<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Go WebSocket Tutorial</title>
  </head>
  <body>
    <h2>Hello World</h2>

    <script>
        let socket = new WebSocket("ws://10.11.2.130:30707/main");
        console.log("Attempting Connection...");

        socket.onopen = () => {
            console.log("Successfully Connected");
            msg={"message_id":"1","user_id":"24a7adb9-9f66-4ec5-be02-7369ad735a5f","user_type":"agent"};
            
            sockThrowDataToServer(JSON.stringify(msg))
            socket.onmessage= function(e){
              var rsp=JSON.parse(e.data);

              if ( rsp["message_id"] == 1 ) {
                recieveRegisterMessage(rsp);
              }else{
                console.log(rsp)
              }
            }
        };
        
        socket.onclose = event => {
            msg={"message_id":"0","user_id":"8209380291839021380","user_type":"agent"};
            console.log("Socket Closed Connection: ", event, msg);
            sockThrowDataToServer(JSON.stringify(msg))
        };

        socket.onerror = error => {
            console.log("Socket Error: ", error);
        };
        function sockThrowDataToServer(data){
          socket.send(data);
          // return;
        }
        function recieveRegisterMessage(rsp){        
          if(rsp["status_code"]==400){
            console.log("INVALID USER",rsp);
            return;
          }else if (rsp["status_code"]==200){
            console.log(rsp);
            alert("START MESSAGING");
          }
      }
    </script>
  </body>
</html>